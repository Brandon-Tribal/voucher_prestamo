## 1Ô∏è‚É£ Descripci√≥n General
Este documento describe el flujo de la solicitud de pr√©stamo personal en el sistema. Se detallan los pasos desde la recepci√≥n de la solicitud hasta la generaci√≥n del voucher, incluyendo validaciones y reglas de negocio.

## 2Ô∏è‚É£ Flujo del Sistema

| Paso                 | Acci√≥n                                   | Posible Resultado |
|----------------------|------------------------------------------|-------------------|
| üìå Cliente           | Env√≠o de JSON con datos                  | Solicitud recibida |
| ‚úÖ Validaciones      | Validar estructura del JSON              | OK / Error 400 |
| üõ†Ô∏è Reglas de Negocio | Evaluar ingresos, egresos, plazo         | Aprobado / Rechazado |
| üéüÔ∏è Generar Voucher   | Si se aprueba, asignar n√∫mero de gesti√≥n | Voucher generado |
| ‚ùå Error             | Si falla, enviar respuesta de rechazo    | `"Ha ocurrido un error"` |


## 3Ô∏è‚É£ Pasos del Flujo

1. **El cliente env√≠a una solicitud** (`POST /api/solicitudes`) con los datos personales, laborales y del pr√©stamo en formato JSON.
2. **El sistema valida la estructura del JSON** para verificar que los datos sean correctos en formato, longitudes y tipos de datos.
3. **Se aplican las reglas de negocio**, que incluyen:
   - Ingresos deben ser mayores o iguales a 4500 GTQ.
   - Egresos no pueden ser mayores o iguales al 40% de los ingresos.
   - El monto solicitado debe estar entre 10,000 y 160,000 GTQ.
   - El plazo debe ser de 6, 9, 12, 18, 24, 36 o 48 meses.
   - La antig√ºedad laboral debe ser de al menos 6 meses y 7 d√≠as.
   - Validaciones externas: DPI y Selphi.
4. **Si la solicitud es aprobada**, se genera un n√∫mero de gesti√≥n aleatorio y un voucher con la informaci√≥n consolidada.
5. **Si la solicitud no es aprobada**, el sistema devuelve un mensaje indicando el motivo del rechazo.
6. **Si un servicio externo falla**, el sistema devuelve un mensaje de error gen√©rico: `"Ha ocurrido un error"`.

## 4Ô∏è‚É£ Respuestas del Sistema

### ‚úÖ Solicitud Aprobada
```json
{
  "numero_gestion": "GEST-123456",
  "datos_personales": { "nombres": "Juan", "apellidos": "P√©rez", "correo": "juan@example.com" },
  "total_ingresos": 5000,
  "total_egresos": 2000
}
```

### ‚ùå Solicitud Rechazada por Reglas de Negocio
```json
{
  "error": "No aplica para el pr√©stamo: ingresos menores a 4500."
}
```

### ‚ö†Ô∏è Error en un Servicio Externo
```json
{
  "error": "Ha ocurrido un error"
}
```

## 5Ô∏è‚É£ Consideraciones Especiales

- **El campo "Otros Ingresos" depende de una Feature Flag**.
  - Si `EnableOtrosIngresos = false`, cualquier valor distinto de cero en `otros_ingresos` causa un error.
  - Si `EnableOtrosIngresos = true`, se permite su uso y validaciones.

## 6Ô∏è‚É£ C√≥mo Ejecutar la API

### üîπ Prerrequisitos
- Tener Go instalado.
- Clonar el repositorio.

### üîπ Pasos para Ejecutar
```bash
git clone https://github.com/Brandon-Tribal/voucher_prestamo.git
cd core-migracion
go mod tidy
go run main.go
```

- La API estar√° disponible en: `http://localhost:8080/api/solicitudes`

---

### üöÄ Conclusi√≥n
Este documento describe el flujo del sistema de solicitud de pr√©stamos. Se detallan los pasos, reglas de negocio y respuestas esperadas, permitiendo a los desarrolladores y analistas entender el funcionamiento general del servicio.

